---
title: 攻击研判与受控外联技巧总结
tags:
  - 笔记
categories: 安服工作
keywords: 护网行动
top_img: https://pic.imgdb.cn/item/64aae46e1ddac507cc3c4359.jpg
cover: https://pic.imgdb.cn/item/64aae46e1ddac507cc3c4359.jpg
description: 本文记录了作者在安服工作涉及漏洞修复时所需的知识点
---
## 攻击研判

### Payload 特征分析法

#### 分析方法

依据积累的相关漏洞经验和正常的业务请求的字段、参数，针对攻击内容的 payload 进行观察、分析，判定各类协议的字段内容是否是真实的攻击载荷。

#### 案例：Log4j2 RCE

研判方法：HTTP 请求头、HTTP 参数、X-Forwarded-For 字段、HTTP 请求体等进行综合分析。

研判说明：对于有明显攻击特征的 HTTP 类攻击事件，应结合上述研判方法的线索进行确认。

研判示例：请求中包含 Log4j 远程命令执行漏洞特征。

适用场景：Apache log4j2 攻击、SQL注入、Webshel检测等

![log4j rce]()

### 威胁情报辅助研判法

#### 分析方法

通过威胁情报查询开源威胁情报平台中对攻击IP的信誉标记来辅助判定，必要时可多家平台联合查询，综合评判

#### 案例：恶意 IP 信息

攻击源IP不断地发起大SYN包，疑似漏洞扫描，结合IP威胁情报确认该IP为恶意。点击该攻击 IP 跳转到平台的情报查询结果页面，查看该攻击IP的“可信程度”、“活跃度”、“攻击情报标签”、发起的“正面攻击”历史记录等信息，确认该 IP 是否为恶意。

若告警详情如上一条“规则匹配特征”无攻击特征或为“不可见Payload“，则可在‘威胁情报管理->威胁情报查询”页面中查询该告警中的告警IP有无“攻击情报标签”与“外联情报标签”以及“历史攻击单位”来进行辅助研判。

### 攻击 IP 画像研判法

#### 分析方法

结合资产测绘手段确认 IP 信息，通过 IP 指纹信息、服务端口等画像判断是否具备作为攻击 IP 的特征，辅助研判攻击的准确性。
#### 案例：肉鸡漏洞扫描

研判方法：通过资产测绘手段研判攻击源IP的信息，是否有运行网站、是否有运行高危端口，可参考资产测绘站点fofa、zoomeye、censys、 shodan等 。

研判说明：如果攻击源IP开放常见服务端口，如http、ftp、 telnet、 3389等， 则可辅助确定该攻击源IP为黑客控下的肉鸡。

研判示例：非标准端口上的MS终端服务器流量。点击该攻击IP跳转到平台的情报查询结果页面，查看该攻击IP的基本信息和资产标签信息，确认该IP是否为恶意。

适用场景：大SYN包检测、拒绝服务攻击、TCP端口扫描、远程注入攻击等
#### 案例：

结合网络空间资产测绘平台对攻击源 IP 进行资产检索，可以判断 IP 或域名企业归属以及资产画像。以域名 `msg.qy.net` 为例：

一般情况而言，我们进行研判时，通常会遵循两个原则： 

1. 对确定攻击的来源IP进行连坐，将其所有告警进行一键确认，包括原本无法确定是否攻击的告警；
2. 对确认为非攻击的业务数据误报进行详细到目标IP、端口、规则的“最小化”加白操作原则。即“攻击IP连坐，最小化加白”。

### 攻击历史扩线关联研判法

#### 分析方法

结合 IP 历史攻击单位、历史攻击记录、攻击频率等情况进行关联分析研判。

#### 案例：结合历史攻击单位

研判方法：通过安全运营管理平台查询攻击源 IP 对其他单位的正面历史攻击记录，确认攻击源 IP 是否恶意。

研判说明：如果攻击源IP的正面历史攻击记录包含多个单位，则可确定攻击源 IP 为恶意。

研判示例：非标准端口上的 MS 终端服务器流量。点击该攻击IP跳转到平台的情报查询结果页面，查看该攻击IP发起的“正面攻击”历史记录等信息，确认该IP是否为恶意。

适用场景：大SYN包检测、拒绝服务攻击、TCP端口扫描、远程注入攻击等。

#### 案例：结合历史正面攻击

![历史正面攻击案例]()

#### 案例：结合攻击频率研判

研判方法：在实际的研判经验过程中，对历史数据进行分析，归类常见发起攻击的国外 IP，在后续见到该 IP 即可快速进行恶意行为确认。

研判说明：经数据汇总统计，如果是频繁发起攻击的国外IP，则可确认为恶意。

研判示例：无

适用场景：各类攻击行为。

### 攻击意图推测研判法

#### 分析方法

通过攻击特征分析，推测攻击者的攻击意图，确定其攻击的真实性。
#### 案例：探测扫描类

探测类的攻击行为，通常会选择在反馈内容中进行输出，或者对攻击者指定目标进行访问，即“攻击内容必然包括如 `echo` 、`alert` 、 `{URL}` `、 {指定随机乱码} 等具备一定标识特征的内容，也包括各类常见 SQL 注入攻击字符串，如 `sleep` 、 `wait` 、 `concat` 、`updatexml" ;“AND updatexml(1,concat(0x7e,SUBSTRING(md5(1),9,16),0x7e),1)”`



