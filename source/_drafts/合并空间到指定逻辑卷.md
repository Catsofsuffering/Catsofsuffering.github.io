
## 问题

通过命令 `lsblk` 可以看到如下信息： 
`NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 0 20G 0 disk ├─sda1 8:1 0 1M 0 part ├─sda2 8:2 0 1.8G 0 part /boot └─sda3 8:3 0 18.2G 0 part └─ubuntu--vg-ubuntu--lv 252:0 0 10G 0 lvm / sdb 8:16 0 20G 0 disk └─backupvg-backuplv 252:1 0 20G 0 lvm /opt/backup sr0 11:0 1 2.6G 0 rom `

我想将`sdb`用于增大`ubuntu--vg-ubuntu--lv`，现在应该如何操作

## 回复

要将 `/dev/sdb` 用于扩展 `ubuntu--vg-ubuntu--lv`，需要先释放 `sdb` 当前被 `backupvg-backuplv` 占用的空间，然后将其加入 `ubuntu--vg` 卷组并扩展逻辑卷。以下是详细步骤：

### 注意事项：

1. **备份数据**：操作前**务必备份 `/opt/backup` 的数据**，后续步骤会清除 `sdb` 上的所有数据。
2. **卸载挂载点**：确保 `/opt/backup` 未被使用。

### 操作步骤：

#### 1. 卸载 `/opt/backup` 并删除旧的 LVM 配置

```bash
sudo umount /opt/backup                  # 卸载挂载点
sudo lvremove /dev/backupvg/backuplv -y  # 删除逻辑卷
sudo vgremove backupvg                   # 删除卷组
sudo pvremove /dev/sdb                   # 清除物理卷属性
```

#### 2. 将 `sdb` 加入 `ubuntu--vg` 卷组

```bash
sudo pvcreate /dev/sdb                   # 将 sdb 初始化为物理卷
sudo vgextend ubuntu-vg /dev/sdb        # 将 sdb 添加到 ubuntu--vg 卷组
```

#### 3. 扩展 `ubuntu--lv` 逻辑卷

```bash
sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv  # 扩展逻辑卷
```

#### 4. 调整文件系统大小（根据文件系统类型操作）

- **如果是 ext4**：

```bash
  sudo resize2fs /dev/ubuntu-vg/ubuntu-lv
```

- **如果是 xfs**（需确保文件系统已挂载）：

  ```bash
  sudo xfs_growfs /
  ```

### 验证结果

```bash
lsblk
df -h
```

### 关键命令解释

- `pvcreate`：将磁盘标记为 LVM 物理卷。
- `vgextend`：将物理卷加入现有卷组。
- `lvextend`：扩展逻辑卷容量。
- `resize2fs/xfs_growfs`：调整文件系统以使用新空间。

### 完成后

 `sdb` 的空间已合并到 `ubuntu-vg-ubuntu-lv`，原 `/opt/backup` 的数据需从备份恢复（如果需要）。